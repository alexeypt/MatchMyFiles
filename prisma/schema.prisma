generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["typedSql"]
    binaryTargets   = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model File {
    id                      Int      @id @default(autoincrement())
    name                    String
    absolutePath            String
    relativePath            String
    extension               String
    fullName                String
    hash                    String
    longitude               Float?
    latitude                Float?
    size                    BigInt
    fileCreatedDate         DateTime
    fileModifiedDate        DateTime
    fileContentModifiedDate DateTime

    folderId Int
    folder   Folder @relation(fields: [folderId], references: [id], onDelete: Cascade)

    rootFolderId Int
    rootFolder   RootFolder @relation(fields: [rootFolderId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([hash])
    @@index([rootFolderId])
    @@index([folderId])
}

model Folder {
    id                        Int      @id @default(autoincrement())
    name                      String
    absolutePath              String
    relativePath              String
    size                      BigInt
    folderCreatedDate         DateTime
    folderModifiedDate        DateTime
    folderContentModifiedDate DateTime

    rootFolderId Int
    rootFolder   RootFolder @relation(fields: [rootFolderId], references: [id], onDelete: Cascade)

    parentFolderId Int?
    parentFolder   Folder?  @relation("ChildFolders", fields: [parentFolderId], references: [id], onDelete: Cascade)
    childFolders   Folder[] @relation("ChildFolders")

    files File[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([rootFolderId])
    @@index([parentFolderId])
}

model RootFolder {
    id              Int                        @id @default(autoincrement())
    name            String
    description     String?
    path            String
    size            BigInt
    status          RootFolderProcessingStatus @default(Created)
    duplicationData Json?

    folders               Folder[]
    files                 File[]
    comparisonRootFolders ComparisonRootFolder[]

    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt
    comparisonId Int?
}

model ComparisonRootFolder {
    comparisonId Int
    rootFolderId Int
    isPrimary    Boolean

    comparison Comparison @relation(fields: [comparisonId], references: [id], onDelete: Cascade)
    rootFolder RootFolder @relation(fields: [rootFolderId], references: [id])

    @@id([comparisonId, rootFolderId])
}

model Comparison {
    id          Int                        @id @default(autoincrement())
    name        String
    description String?
    status      ComparisonProcessingStatus @default(Created)
    data        Json?

    comparisonRootFolders ComparisonRootFolder[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

enum RootFolderProcessingStatus {
    Created
    Processing
    Completed
    Failed
}

enum ComparisonProcessingStatus {
    Created
    Processing
    Completed
    Failed
}
